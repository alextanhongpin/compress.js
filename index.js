!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e():"function"==typeof define&&define.amd?define([],e):"object"==typeof exports?exports.Compress=e():t.Compress=e()}(this,function(){return function(t){function e(i){if(n[i])return n[i].exports;var r=n[i]={exports:{},id:i,loaded:!1};return t[i].call(r.exports,r,r.exports,e),r.loaded=!0,r.exports}var n={};return e.m=t,e.c=n,e.p="",e(0)}([function(t,e,n){var i,r,a;!function(o,u){r=[e,n(1),n(2),n(3),n(4),n(5),n(6)],i=u,a="function"==typeof i?i.apply(e,r):i,!(void 0!==a&&(t.exports=a))}(this,function(t,e,n,i,r,a,o){"use strict";function u(t){return t&&t.__esModule?t:{default:t}}function s(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function f(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var d=u(e),l=u(n),c=u(i),h=u(r),v=u(a),p=u(o),g=function(){function t(t,e){for(var n,i=0;i<e.length;i++)n=e[i],n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}return function(e,n,i){return n&&t(e.prototype,n),i&&t(e,i),e}}(),w=function(){function t(){f(this,t)}return g(t,[{key:"attach",value:function(t,e,n){var i=this;return new Promise(function(r){var a=document.querySelector(t);a.setAttribute("accept","image/*"),a.addEventListener("change",function(t){var a=i.compress([].concat(s(t.target.files)),e,n);r(a)},!1)})}},{key:"compress",value:function(e,n,i){function r(t,e){var n=new v.default(e);return n.start=window.performance.now(),n.alt=t.name,n.ext=t.type,n.startSize=t.size,p.default.orientation(t).then(function(e){return n.orientation=e,c.default.load(t)}).then(a(n))}function a(t){return function(e){return h.default.load(e).then(function(e){if(t.startWidth=e.naturalWidth,t.startHeight=e.naturalHeight,t.resize){var n=h.default.resize(t.maxWidth,t.maxHeight)(e.naturalWidth,e.naturalHeight),i=n.width,r=n.height;t.endWidth=i,t.endHeight=r}else t.endWidth=e.naturalWidth,t.endHeight=e.naturalHeight;return l.default.imageToCanvas(t.endWidth,t.endHeight,t.orientation)(e)}).then(function(e){return t.iterations=1,t.base64prefix=d.default.prefix(t.ext),o(e,t.startSize,t.quality,t.size,t.minQuality,t.iterations)}).then(function(e){return t.finalSize=d.default.size(e),d.default.data(e)}).then(function(e){t.end=window.performance.now();var n=t.end-t.start;return{data:e,prefix:t.base64prefix,elapsedTimeInSeconds:n/1e3,alt:t.alt,initialSizeInMb:l.default.size(t.startSize).MB,endSizeInMb:l.default.size(t.finalSize).MB,ext:t.ext,quality:t.quality,endWidthInPx:t.endWidth,endHeightInPx:t.endHeight,initialWidthInPx:t.startWidth,initialHeightInPx:t.startHeight,sizeReducedInPercent:100*((t.startSize-t.finalSize)/t.startSize),iterations:t.iterations}})}}function o(t){var e=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,n=4<arguments.length&&void 0!==arguments[4]?arguments[4]:1,i=arguments[3],r=arguments[5],a=l.default.canvasToBase64(t,e),u=d.default.size(a);return r+=1,u>i?o(t,u,e-.1,i,n,r):e>n?o(t,u,e-.1,i,n,r):.5>e?a:a}return Promise.all(e.map(function(e){return"file"===i?r(e,n).then(function(e){return new window.File([t.convertBase64ToFile(e.data,e.ext)],e.alt,{type:e.ext})}):"blob"===i?r(e,n).then(function(e){return t.convertBase64ToFile(e.data,e.ext)}):r(e,n)}))}}],[{key:"convertBase64ToFile",value:function(t,e){return l.default.base64ToFile(t,e)}}]),t}();t.default=w})},function(t,e,n){var i,r,a;!function(n,o){r=[e],i=o,a="function"==typeof i?i.apply(e,r):i,!(void 0!==a&&(t.exports=a))}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=function(t){var e=t.replace(/^data:image\/\w+;base64,/,"").length;return(e-814)/1.37},n=function(t){return t.split(";")[0].match(/jpeg|png|gif/)[0]},i=function(t){return t.replace(/^data:image\/\w+;base64,/,"")},r=function(t){return"data:"+t+";base64,"};t.default={size:e,mime:n,data:i,prefix:r}})},function(t,e,n){var i,r,a;!function(n,o){r=[e],i=o,a="function"==typeof i?i.apply(e,r):i,!(void 0!==a&&(t.exports=a))}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=function(t){for(var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=window.atob(t),i=[],r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return new window.Blob([new Uint8Array(i)],{type:e})},n=function(t,e,n){var i=document.createElement("canvas"),r=i.getContext("2d");return i.width=t,i.height=e,function(a){return!n||8<n?(r.drawImage(a,0,0,i.width,i.height),i):(4<n&&(i.width=e,i.height=t),2===n?(r.translate(t,0),r.scale(-1,1)):3===n?(r.translate(t,e),r.rotate(Math.PI)):4===n?(r.translate(0,e),r.scale(1,-1)):5===n?(r.rotate(.5*Math.PI),r.scale(1,-1)):6===n?(r.rotate(.5*Math.PI),r.translate(0,-e)):7===n?(r.rotate(.5*Math.PI),r.translate(t,-e),r.scale(-1,1)):8===n?(r.rotate(-.5*Math.PI),r.translate(-t,0)):void 0,4<n?r.drawImage(a,0,0,i.height,i.width):r.drawImage(a,0,0,i.width,i.height),i)}},i=function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:.75,n=t.toDataURL("image/jpeg",e);return n},r=function(t){return{KB:t/1e3,MB:t/1e6}};t.default={base64ToFile:e,imageToCanvas:n,canvasToBase64:i,size:r}})},function(t,e,n){var i,r,a;!function(n,o){r=[e],i=o,a="function"==typeof i?i.apply(e,r):i,!(void 0!==a&&(t.exports=a))}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=function(t){return new Promise(function(e,n){var i=new window.FileReader;i.addEventListener("load",function(t){e(t.target.result)},!1),i.addEventListener("error",function(t){n(t)},!1),i.readAsDataURL(t)})};t.default={load:e}})},function(t,e,n){var i,r,a;!function(n,o){r=[e],i=o,a="function"==typeof i?i.apply(e,r):i,!(void 0!==a&&(t.exports=a))}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=function(t){return new Promise(function(e,n){var i=new window.Image;i.addEventListener("load",function(){e(i)},!1),i.addEventListener("error",function(t){n(t)},!1),i.src=t})},n=function(t,e){return function(n,i){if(!t&&!e)return{width:n,height:i};var r=n/i,a=void 0,o=void 0;return r>t/e?(a=Math.min(n,t),o=a/r):(o=Math.min(i,e),a=o*r),{width:a,height:o}}};t.default={load:e,resize:n}})},function(t,e,n){var i,r,a;!function(n,o){r=[e],i=o,a="function"==typeof i?i.apply(e,r):i,!(void 0!==a&&(t.exports=a))}(this,function(t){"use strict";function e(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var n=function t(n){var i=n.quality,r=void 0===i?.75:i,a=n.size,o=void 0===a?2:a,u=n.maxWidth,s=void 0===u?1920:u,f=n.maxHeight,d=void 0===f?1920:f,l=n.resize;e(this,t),this.start=window.performance.now(),this.end=null,this.alt=null,this.ext=null,this.startSize=null,this.startWidth=null,this.startHeight=null,this.size=1e3*(1e3*o),this.endSize=null,this.endWidth=null,this.endHeight=null,this.iterations=0,this.base64prefix=null,this.quality=r,this.resize=void 0===l||l,this.maxWidth=s,this.maxHeight=d,this.orientation=1};t.default=n})},function(t,e,n){var i,r,a;!function(n,o){r=[e],i=o,a="function"==typeof i?i.apply(e,r):i,!(void 0!==a&&(t.exports=a))}(this,function(t){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var e=function(t){return new Promise(function(e){var n=new window.FileReader;n.onload=function(t){var n=new DataView(t.target.result);65496!==n.getUint16(0,!1)&&e(-2);for(var i,r=n.byteLength,a=2;a<r;)if(i=n.getUint16(a,!1),a+=2,65505===i){1165519206!==n.getUint32(a+=2,!1)&&e(-1);var o=18761===n.getUint16(a+=6,!1);a+=n.getUint32(a+4,o);var u=n.getUint16(a,o);a+=2;for(var s=0;s<u;s++)274===n.getUint16(a+12*s,o)&&e(n.getUint16(a+12*s+8,o))}else{if(65280!=(65280&i))break;a+=n.getUint16(a,!1)}e(-1)},n.readAsArrayBuffer(t.slice(0,65536))})};t.default={orientation:e}})}])});
//# sourceMappingURL=index.js.map